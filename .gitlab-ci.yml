#below is for gitlab server runner and school-server-runner

#default runner -> gitlab share runner (randomly)
#close share runner and group runner and redirect to your own machine gitlab runner
#can modify runner to run untagged script

#artifacts is to store this job's(stage) specific result (small, between stages) to remote server
#cache is to store this pipeline's specific result (big, package, dependency) to local server

#to next job
#every end of a stage will remove the file it install

stages:
  - dependencies
  - build
  - deploy

install_dependencies:
  stage: dependencies
  script:
      - npm install
  only:
      - main
  cache:
    key:
      files:
        - package-lock.json
    paths:
      - node_modules

Build:
  stage: build
  script:
      - npm link @angular/cli
      - ng build --prod --base-href /tinder-like-app-gitlab/
  only:
      - main
  artifacts:
    paths:
      - dist/

# remove destination folder file and subdir
# xcopy to copy file to another specific folder
# /s all file, /q yes to all, 2>null(even if not exist, don't throw error)
Pull:
  stage: deploy
  script:
    - rmdir /s /q C:\inetpub\wwwroot\tinder-like-app-gitlab\assets 2>null
    - del /s /q C:\inetpub\wwwroot\tinder-like-app-gitlab\ 2>null
    - xcopy "C:\Users\user\Desktop\GitLab-Runner\builds\zKs7bwne\0\maoxun1\tinder-like-app\dist" "C:\inetpub\wwwroot\tinder-like-app-gitlab" /e
    - echo "deploy dist to local server specific folder"
  # tags:
  #   - school-server-runner


#copy file (test in serevr first)
#separate branch
#ssh to connect multiple machine
